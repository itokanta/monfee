<%= form_with model: [student, attendance], local: true do |f|%>
  <div class='field'>
    <div class='field-label'>
      <%= f.label :entry, "出席日"%>
    </div>
    <div class='field-input'>
      <%= f.date_select :entry, use_month_numbers:true, start_year:Time.now.year, end_year:1900, prompt:"--" %>
    </div>
  </div>
  
  <div class='field'>
    <div class='field-label'>
      <%= f.label :fee_plan_id, "月謝プラン"%>
    </div>
    <div class='field-input'>
      <%= f.collection_select :fee_plan_id, @fee_plans, :id, :name, 
                              { prompt: "月謝プランを選択してください" }, 
                              { class: 'form-control', id: 'fee_plan_select', required: true } %>
    </div>
  </div>
  
  <!-- 金額は選択されたプランから自動設定されるため、表示のみ -->
  <div class='field'>
    <div class='field-label'>
      料金（自動設定）
    </div>
    <div class='field-input'>
      <input type="text" id="fee_display" class="form-control" readonly placeholder="プランを選択すると表示されます">
      <%= f.hidden_field :fee, id: 'fee_input' %>
    </div>
  </div>
  
  <div class='actions'>
    <%= f.submit "登録", class: 'btn'%>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const feePlanSelect = document.getElementById('fee_plan_select');
  const feeInput = document.getElementById('fee_input');
  const feeDisplay = document.getElementById('fee_display');
  
  if (feePlanSelect && feeInput && feeDisplay) {
    // プランと金額のマッピング
    const planAmounts = {
      <% @fee_plans.each do |plan| %>
        '<%= plan.id %>': <%= plan.amount %><%= ',' unless plan == @fee_plans.last %>
      <% end %>
    };
    
    feePlanSelect.addEventListener('change', function() {
      const selectedPlanId = this.value;
      if (selectedPlanId && planAmounts[selectedPlanId]) {
        const amount = planAmounts[selectedPlanId];
        feeInput.value = amount;
        feeDisplay.value = '¥' + amount.toLocaleString();
      } else {
        feeInput.value = '';
        feeDisplay.value = '';
      }
    });
  }
});
</script>